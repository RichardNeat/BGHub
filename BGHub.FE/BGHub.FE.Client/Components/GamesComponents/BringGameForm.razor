@using BGHub.Models
@rendermode InteractiveAuto

<div class="card shadow-sm p-3 mt-4 mb-4">
    <div class="card-body">
        <h6 class="card-title mb-3">Bring a game to this event:</h6>

        <EditForm Model="Model" OnValidSubmit="HandleValidSubmit" FormName="BringGame">
            <div class="mb-3">
                <InputSelect @bind-Value="selectedGameId" id="gameSelect" class="form-select">
                    <option disabled selected value="0">-- Select a Game --</option>
                    @foreach (var game in GameCollection)
                    {
                        <option value="@game.Id">@game.Name</option>
                    }
                </InputSelect>
            </div>

            <button type="submit" disabled="@(selectedGameId == 0)" class="btn btn-primary w-100">Add Game</button>
        </EditForm>
    </div>
</div>

@code {
    public Game Model = new();

    private int selectedGameId { get; set; }

    // Update this to get users game collection from DB
    public List<Game> GameCollection { get; set; } = new List<Game>
    {
        new Game {Id=4, Name="Blood on the Clocktower", Owner=new User{ Id=1, Name="Rich"}, BGGId=240980, ImageUrl="https://cf.geekdo-images.com/HINb2nkFn5IiZxAlzQIs4g__original/img/e7izEwSmnBPiErsIF6hlWbgybBE=/0x0/filters:format(jpeg)/pic7009391.jpg"},
        new Game {Id=5, Name="Legendary Encounters: An Alien Deck Building Game", Owner=new User{ Id=1, Name="Rich"}, BGGId=146652, ImageUrl="https://cf.geekdo-images.com/jSz_KRUxsjGYitoqx9YH1Q__original/img/nrvJtT-4tYTD0fp3Cr57SKpfMfw=/0x0/filters:format(jpeg)/pic2225180.jpg"},
    };

    [Parameter]
    public EventCallback<Game> HandleGameAdded { get; set; }

    public async Task HandleValidSubmit()
    {
        var selectedGame = GameCollection.FirstOrDefault(g => g.Id == selectedGameId);
        await HandleGameAdded.InvokeAsync(selectedGame);
        // Call to DB to add game to event
    }
}
